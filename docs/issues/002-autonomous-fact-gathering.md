# AI による自律的な情報収集で曖昧性解消をサポートする

## 問い

**「neumann は、曖昧性を指摘するだけでなく、解消に必要なファクトを外部ツールから自律的に収集・推論して提案すべきか？すべきであれば、どのように実装すべきか？」**

## 背景

### 現状の課題

neumann v1.0 は曖昧性を「検出・指摘」することに特化している。

**例: 曖昧性の検出**
- 入力: 「全体的に厳しい状況です」
- 出力: 「定量性不足。具体的な数値やデータが必要です」

**問題点**:
- 解消に必要な情報（前月比データ、案件フェーズ、KPI 実績値等）はユーザーが手入力
- ユーザーは「どこにデータがあるか」を覚えていなければならない
- CEO が求める「Zero Latency（聞く前にファクトが揃っている）」には不十分

### 提案機能

AI が自律的にツール（CRM、データベース、スプレッドシート等）から情報を収集し、曖昧性解消に必要なファクトを推論・提案する。

**例: 自律的な情報収集**
- 入力: 「全体的に厳しい状況です」
- AI 検出: 定量性不足
- AI 推論: 「この文脈で『厳しい』とは商談化率の低下を指していると推測」
- AI 収集: Salesforce から過去3ヶ月の商談化率データを取得
- AI 提案: 「前月比で商談化率が 25% → 10% に低下（-15pt）と記載することを推奨」

### 価値の拡張

| 機能 | v1.0（現状） | v2.0（提案） | 価値の変化 |
|------|------------|------------|-----------|
| 曖昧性検出 | ✅ 可能 | ✅ 可能 | 変化なし |
| 解消方法の提示 | ✅ 可能（一般的な提案） | ✅ 可能（文脈に応じた提案） | 精度向上 |
| 必要情報の特定 | ❌ ユーザーが判断 | ✅ AI が推論 | **新規価値** |
| データ取得 | ❌ ユーザーが手入力 | ✅ AI が自律収集 | **Zero Latency 実現** |

## 論点

この機能を実装すべきか、実装する場合どう設計するかを決定するために検討すべき主要な論点：

1. **何を収集すべきか**（情報源の特定）
2. **どう収集するか**（技術的実現性）
3. **どう推論するか**（推論精度の確保）
4. **どう提示するか**（UX 設計）
5. **プライバシー・セキュリティ**（データアクセス権限）
6. **いつ実装するか**（優先度とフェーズ）

## 論点分解

### 論点1: 何を収集すべきか（情報源の特定）

**評価軸**:
- 曖昧性解消への寄与度
- データの取得可能性
- 実装コスト

**候補となる情報源**:

| 情報源 | 解消できる曖昧性パターン | 取得可能性 | 実装コスト | 優先度 |
|--------|----------------------|-----------|-----------|--------|
| **Salesforce（CRM）** | 定量性不足（商談数、受注率、ARR 等） | 高（API 充実） | 中（OAuth + API 実装） | ★★★★★ |
| **Google Sheets** | 定量性不足（KPI 実績値、予実管理） | 高（Google API） | 低（OAuth のみ） | ★★★★★ |
| **Notion Database** | 論理性不足（根拠となるドキュメント参照） | 中（API あり） | 中（複雑な構造） | ★★★☆☆ |
| **Slack** | 未解決アクション（会議で決まった TODO） | 高（API 充実） | 中（検索精度） | ★★★☆☆ |
| **GitHub Issues/PRs** | 未解決アクション（開発タスクの進捗） | 高（API 充実） | 低（REST API） | ★★★☆☆ |
| **Google Calendar** | 定量性不足（ミーティング時間、稼働率） | 高（Google API） | 低（OAuth のみ） | ★★☆☆☆ |
| **Supabase（内部 DB）** | KPI 実績値（neumann 内で管理） | 最高（直接アクセス） | 最低（既存） | ★★★★★ |

**優先度判定基準**:
- ★★★★★ (v1.1 で実装検討): Salesforce, Google Sheets, Supabase
- ★★★☆☆ (v1.2 で実装検討): Notion, Slack, GitHub
- ★★☆☆☆ (v2.0 で実装検討): Google Calendar, その他

### 論点2: どう収集するか（技術的実現性）

**評価軸**:
- API の安定性
- 認証の複雑度
- レート制限・コスト

**技術選択肢**:

| 技術アプローチ | 概要 | メリット | デメリット | 適用場面 |
|--------------|------|---------|-----------|---------|
| **MCP (Model Context Protocol)** | Claude Desktop が提供する統合規格 | 標準化、低実装コスト | Claude Desktop 依存 | v1.1〜v1.2（実験） |
| **Direct API Integration** | Salesforce API 等を直接呼び出し | 柔軟性高、プロダクション対応 | 各 API の実装必要 | v1.2〜v2.0（本番） |
| **Zapier/Make（ノーコード連携）** | 外部統合ツールで API を抽象化 | 実装コスト最低 | 柔軟性低、外部依存 | v1.1（PoC） |
| **Tool Calling (Vercel AI SDK)** | AI が必要に応じてツールを呼び出し | 動的、文脈適応 | プロンプト設計難 | v1.2〜v2.0（推論機能） |

**推奨アプローチ（段階的実装）**:

1. **v1.1（PoC）**: Supabase 内部データ + Google Sheets（MCP または Direct API）
2. **v1.2（拡張）**: Salesforce（Direct API + Tool Calling）
3. **v2.0（統合）**: Notion, Slack, GitHub（統合プラットフォーム化）

### 論点3: どう推論するか（推論精度の確保）

**評価軸**:
- 推論の正確性（正しいデータを特定できるか）
- 誤推論のリスク（間違ったデータを提示してしまうリスク）
- ユーザーの信頼性（AI の推論を信頼できるか）

**推論パターン**:

#### パターンA: ルールベース推論（決定論的）

**アプローチ**:
- 曖昧性パターンと情報源を 1:1 でマッピング
- 「定量性不足 + 商談化率言及 → Salesforce の Opportunity データ」

**メリット**:
- 精度が高い（誤推論リスク低）
- 実装が容易

**デメリット**:
- 柔軟性が低い（未知のパターンに対応不可）
- ルールのメンテナンスコスト

**適用場面**: v1.1〜v1.2（初期実装）

#### パターンB: AI 推論（確率論的）

**アプローチ**:
- Claude に文脈を渡し、必要な情報源を推論させる
- Tool Calling で動的にデータ取得

**例**:
```typescript
const tools = [
  { name: 'getSalesforceOpportunities', description: '商談データを取得' },
  { name: 'getGoogleSheetKPIs', description: 'KPI実績値を取得' },
];

const result = await generateText({
  model: claude,
  prompt: `
    レポート: 「全体的に厳しい状況です」
    曖昧性: 定量性不足
    どのツールで情報を取得すべきか？
  `,
  tools,
});
```

**メリット**:
- 柔軟性が高い（未知のパターンにも対応）
- ルールのメンテナンス不要

**デメリット**:
- 誤推論のリスク（間違ったツールを呼ぶ可能性）
- コスト（LLM API 呼び出し）

**適用場面**: v1.2〜v2.0（本格実装）

#### パターンC: ハイブリッド（ルール + AI）

**アプローチ**:
- よくあるパターンはルールで処理
- ルールに合致しない場合のみ AI 推論にフォールバック

**メリット**:
- 精度とコストのバランス
- 段階的な学習が可能（ルールを徐々に追加）

**デメリット**:
- 実装の複雑度が高い

**適用場面**: v2.0〜（成熟期）

**推奨アプローチ**: v1.1 はパターンA（ルールベース）、v1.2〜v2.0 でパターンC（ハイブリッド）に移行

### 論点4: どう提示するか（UX 設計）

**評価軸**:
- ユーザーの信頼性（AI が取得した情報を信じられるか）
- 修正の容易さ（誤った推論を修正できるか）
- 学習効果（ユーザーがデータの意味を理解できるか）

**提示方法の選択肢**:

#### 選択肢A: 自動適用（ゼロクリック）

**UI**:
```
問題: 「全体的に厳しい」は曖昧です
✅ 自動修正: 「前月比で商談化率が 25% → 10% に低下（-15pt）」

[元に戻す]
```

**メリット**:
- ユーザー負荷最小（Zero Latency 実現）
- 体験が滑らか

**デメリット**:
- 誤推論時のリスク大（間違ったデータが本文に入る）
- ユーザーの学習効果低（考えなくなる）

**適用場面**: v2.0〜（推論精度が十分に高い場合のみ）

#### 選択肢B: ワンクリック適用（推奨）

**UI**:
```
問題: 「全体的に厳しい」は曖昧です

💡 AI が情報を取得しました:
  - データソース: Salesforce (2025-02 商談データ)
  - 商談化率: 25% → 10% (-15pt)

改善案: 「前月比で商談化率が 25% → 10% に低下（-15pt）」

[この案を使う] [自分で編集]
```

**メリット**:
- 誤推論時のリスク低（ユーザーが確認してから適用）
- 学習効果中（データソースが見える）
- 生産性高（ワンクリックで適用）

**デメリット**:
- 完全な Zero Latency ではない（1クリック必要）

**適用場面**: v1.1〜v2.0（推奨）

#### 選択肢C: 情報提示のみ（ガイド）

**UI**:
```
問題: 「全体的に厳しい」は曖昧です

💡 関連する情報:
  - Salesforce: 商談化率 25% → 10% (-15pt)
  - Google Sheets: 月次目標達成率 60%

ガイド質問:
- 何が厳しいですか？ [商談化率の低下]
- 前月と比べてどのくらい？ [15pt低下]
```

**メリット**:
- 学習効果最高（自分で考える）
- 誤推論のリスク最小（ユーザーが判断）

**デメリット**:
- ユーザー負荷が高い（Guided Improvement と変わらない）

**適用場面**: v1.1（学習フェーズ）

**推奨アプローチ**:
- v1.1: 選択肢C（情報提示のみ）で学習効果を重視
- v1.2〜: 選択肢B（ワンクリック適用）で生産性を重視
- ユーザー設定で切り替え可能にする

### 論点5: プライバシー・セキュリティ

**評価軸**:
- データアクセス範囲の適切性
- 情報漏洩リスク
- ユーザーの管理負担

**検討事項**:

| 項目 | リスク | 緩和策 | 実装タイミング |
|------|--------|--------|--------------|
| **OAuth スコープ** | 過剰な権限取得 | 最小権限の原則（read-only） | v1.1〜 |
| **データ保存** | Supabase に外部データを保存 | キャッシュのみ、定期削除 | v1.1〜 |
| **ログ記録** | AI の推論ログに機密情報 | PII のマスキング | v1.2〜 |
| **アクセス制御** | 他のユーザーのデータが見える | RLS（Row Level Security） | v1.1〜 |
| **データ共有** | Claude API にデータを送信 | Anthropic の ToS 確認 | v1.1〜 |

**セキュリティ原則**:
1. **最小権限**: 必要最小限のデータのみ取得
2. **透明性**: どのデータを取得したか明示
3. **ユーザー管理**: 連携の ON/OFF をユーザーが制御
4. **データ保持期間**: 取得データは 24 時間でキャッシュ削除

### 論点6: いつ実装するか（優先度とフェーズ）

**評価軸**:
- ビジネス価値（Zero Latency 実現への寄与度）
- 実装コスト
- リスク（誤推論、セキュリティ）

**フェーズ別の実装範囲**:

| フェーズ | 実装内容 | データソース | 推論方式 | UX | 期間 | 価値 |
|---------|---------|------------|---------|----|----|------|
| **v1.0** | 曖昧性検出のみ（現状） | なし | なし | 指摘のみ | 完了 | ★★★☆☆ |
| **v1.1** | 内部データ参照 | Supabase のみ | ルールベース | 情報提示 | 2週間 | ★★★★☆ |
| **v1.2** | 外部ツール連携（基本） | Salesforce, Google Sheets | ハイブリッド | ワンクリック適用 | 4週間 | ★★★★★ |
| **v2.0** | 統合プラットフォーム | Notion, Slack, GitHub 等 | AI 推論 | 自動適用（オプション） | 8週間 | ★★★★★ |

**v1.1 で実装すべき最小構成（MVP）**:

1. **Supabase 内部データ参照**
   - KPI 実績値の自動取得
   - 前月比の自動計算
   - 実装コスト: 低（既存 DB）
   - 価値: 中（内部データのみ）

2. **Google Sheets 連携（実験）**
   - OAuth 実装
   - シンプルな範囲指定での値取得
   - 実装コスト: 中（2〜3日）
   - 価値: 高（実際の業務データ）

3. **情報提示 UI**
   - 取得したデータをカード形式で表示
   - ユーザーが手動でコピー＆ペースト
   - 実装コスト: 低（1日）
   - 価値: 中（学習効果）

**v1.1 MVP の成功基準**:
- ユーザーが手入力する情報量が 30% 削減
- データ取得の成功率が 80% 以上
- 誤推論率が 10% 以下

## 仮説構築

### 仮説1: ルールベース推論で十分な精度が出る

**仮説**:
- v1.1 では、曖昧性パターンと情報源を 1:1 でマッピングするルールベースで十分な精度が出る
- 「定量性不足 + 商談化率言及 → Salesforce」のような単純なルールで 80% 以上カバー可能

**根拠**:
- neumann が検出する曖昧性パターンは 5 種類（FI, LQ, UA, SA, MC）と限定的
- 週次レポートの文脈は定型的（売上、商談、KPI 等）
- 初期は内部データ（Supabase）のみで誤推論リスクを抑えられる

**検証方法**:
- v1.1 で実装後、10 件のサンプルレポートで精度を測定
- 正解率 80% 以上なら v1.2 に進む、80% 未満なら AI 推論にエスカレート

**期待される効果**:
- 実装コストを最小化（2週間以内）
- 誤推論リスクを抑えつつ、Zero Latency の第一歩を実現

### 仮説2: Google Sheets が最も価値の高い情報源である

**仮説**:
- 初期の外部連携では、Salesforce よりも Google Sheets を優先すべき
- スタートアップ・中小企業では KPI 管理を Google Sheets で行っているケースが多い

**根拠**:
- Google Sheets は汎用性が高く、様々な KPI を管理可能
- API がシンプル（OAuth + Sheets API のみ）
- ユーザーが自分でデータ構造を定義できる（柔軟性）

**検証方法**:
- ユーザーインタビュー（CEO へのヒアリング）
- 「KPI 実績値をどこで管理していますか？」

**期待される効果**:
- Salesforce 連携の実装コストを回避（v1.2 に延期）
- v1.1 でも実用的な価値を提供

**リスク**:
- Google Sheets の構造が自由すぎて、自動認識が難しい
- 緩和策: 初期はテンプレート（neumann 推奨フォーマット）を提供

### 仮説3: 情報提示のみ（ワンクリック適用なし）でも十分な価値がある

**仮説**:
- v1.1 では、取得したデータを「提示」するだけで、ユーザーの負荷を 30% 削減できる
- ワンクリック適用は v1.2 で実装すれば十分

**根拠**:
- 現状、ユーザーは「どこにデータがあるか探す」→「データを開く」→「値をコピー」→「レポートに貼り付け」の 4 ステップ
- neumann が「データを開く」→「値をコピー」の 2 ステップを自動化するだけで 50% 削減

**検証方法**:
- v1.1 リリース後、ユーザーの行動ログを分析
- 「AI が提示したデータをコピーして使った割合」を測定

**期待される効果**:
- v1.1 の実装コストを削減（UI がシンプル）
- 誤推論時のリスクを最小化（ユーザーが最終判断）

## 仮説の評価

上記 3 つの仮説を、主要な評価軸で比較：

| 仮説 | 実装コスト | 精度 | ユーザー価値 | リスク | v1.1 適合 | 総合評価 |
|------|-----------|------|------------|--------|----------|---------|
| ルールベース推論 | ◎（低） | ○（80%想定） | ○（内部データのみ） | ◎（低） | ◎ | ★★★★☆ |
| Google Sheets 優先 | ○（中） | △（構造依存） | ◎（業務データ） | ○（構造が自由） | ○ | ★★★★☆ |
| 情報提示のみ | ◎（低） | - | ○（30%削減） | ◎（最小） | ◎ | ★★★★☆ |

**評価基準**:
- ◎: 非常に良い
- ○: 良い
- △: やや懸念あり
- ×: 問題あり

**v1.1 で実装すべき組み合わせ**:
- ルールベース推論 + Google Sheets 連携 + 情報提示のみ

## 結論

### v1.1 で実装する機能（Autonomous Fact Gathering MVP）

**実装範囲**:

1. **Supabase 内部データ参照**
   - KPI 実績値の自動取得（neumann 内部で管理されているデータ）
   - 前月比の自動計算
   - 実装: `src/domain/kpi/utils.ts` に関数追加

2. **Google Sheets 連携（実験版）**
   - OAuth 2.0 実装（Google Cloud Console でプロジェクト作成）
   - Sheets API でセル範囲を指定して値取得
   - 実装: `src/lib/integrations/google-sheets.ts` を新規作成

3. **情報提示 UI（カード形式）**
   - 取得したデータを Audit Panel 内にカード表示
   - ユーザーが手動でコピー＆ペーストで本文に反映
   - 実装: `src/features/editor/components/FactCard.tsx` を新規作成

4. **ルールベース推論エンジン**
   - 曖昧性パターン → 情報源のマッピングルール定義
   - 実装: `src/domain/audit/inference-rules.ts` を新規作成

**実装しない範囲（v1.2 以降に延期）**:
- Salesforce 連携
- Notion, Slack, GitHub 連携
- AI 推論（Tool Calling）
- ワンクリック適用（自動修正）

**実装優先度**:
1. **Must Have（v1.1）**: Supabase 内部データ参照、情報提示 UI
2. **Should Have（v1.1）**: Google Sheets 連携、ルールベース推論
3. **Could Have（v1.2）**: Salesforce 連携、AI 推論
4. **Won't Have（v2.0）**: 自動適用、統合プラットフォーム

**成功基準**:
- ユーザーが手入力する情報量が 30% 削減
- データ取得の成功率が 80% 以上
- 誤推論率が 10% 以下
- v1.1 リリースまでの実装期間が 2 週間以内

### 具体的な実装イメージ（v1.1）

#### UI イメージ

**Audit Panel 内の Fact Card**:
```
┌───────────────────────────────────┐
│ 🔴 定量性不足                      │
│                                   │
│ 「全体的に厳しい」の定義が不明瞭です│
│                                   │
│ 💡 AI が関連情報を取得しました:     │
│ ┌─────────────────────────────┐   │
│ │ 📊 データソース: KPI実績値     │   │
│ │                              │   │
│ │ 商談化率:                     │   │
│ │ • 前月: 25%                   │   │
│ │ • 今月: 10%                   │   │
│ │ • 差分: -15pt                 │   │
│ │                              │   │
│ │ [値をコピー]                  │   │
│ └─────────────────────────────┘   │
│                                   │
│ 💡 改善案:                         │
│ 「前月比で商談化率が25%→10%に      │
│  低下（-15pt）」                  │
│                                   │
│ [自分で書く]                       │
└───────────────────────────────────┘
```

#### データフロー

```
1. ユーザーがレポートを入力
   ↓
2. 曖昧性検出エンジン実行
   「全体的に厳しい」→ 定量性不足（LQ）
   ↓
3. 推論エンジン起動
   ルール: LQ + 商談化率言及 → KPI実績値取得
   ↓
4. データ取得
   Supabase: SELECT conversion_rate FROM kpi_actual WHERE month = '2025-02'
   ↓
5. 前月比計算
   前月: 25%, 今月: 10%, 差分: -15pt
   ↓
6. Fact Card 表示
   ユーザーが確認してコピー
```

#### ファイル構成（新規作成）

```
src/
├── domain/
│   └── audit/
│       ├── inference-rules.ts      # NEW: ルールベース推論
│       └── fact-gathering.ts       # NEW: 情報収集ロジック
│
├── lib/
│   └── integrations/
│       └── google-sheets.ts        # NEW: Google Sheets API クライアント
│
└── features/
    └── editor/
        └── components/
            └── FactCard.tsx        # NEW: 取得データ表示カード
```

## ネクストアクション

### 即座に実行（v1.1 実装前の準備）

1. **DEC-009 意思決定記録の作成**
   - ファイル: `docs/05_decisions/DEC-009-autonomous-fact-gathering.md`
   - この論点ドキュメントの結論を Decision Record として記録

2. **User Stories の追加**
   - `docs/02_product/features/USER_STORIES.md`
   - US-015: AI による情報収集（Manager 向け）
   - US-016: 情報ソース管理（CEO 向け）

3. **Google Cloud Console の準備**
   - プロジェクト作成
   - Sheets API の有効化
   - OAuth 2.0 認証情報の作成

### v1.1 実装（2週間）

**Week 1: コア機能実装**
1. Supabase 内部データ参照ロジック実装
2. ルールベース推論エンジン実装
3. FactCard コンポーネント実装

**Week 2: Google Sheets 連携**
4. Google OAuth 実装
5. Sheets API 統合
6. エラーハンドリング・テスト

### v1.2 以降で検討

7. **Salesforce 連携**
   - Salesforce OAuth 実装
   - Opportunity, Account データ取得

8. **AI 推論（Tool Calling）**
   - Vercel AI SDK の Tool Calling 実装
   - プロンプト設計

9. **ワンクリック適用**
   - 自動修正 UI 実装
   - 誤推論時の Undo 機能

## 残論点

### 未解決の論点

1. **Google Sheets の構造認識**
   - ユーザーが自由にフォーマットを定義できる Google Sheets で、どうやって「商談化率」のセルを特定するか？
   - → **v1.1 の対応**: テンプレート提供（neumann 推奨フォーマット）+ 手動マッピング UI
   - → **v1.2 の対応**: AI によるセル内容の推論（ヘッダー行を読んで自動マッピング）

2. **推論の透明性**
   - AI が「なぜこのデータを取得したか」を説明すべきか？
   - → **v1.1 の対応**: データソース名のみ表示
   - → **v1.2 の対応**: 推論ロジックの説明を追加（「商談化率が言及されているため」）

3. **データ鮮度の管理**
   - Salesforce 等のデータをキャッシュする場合、どのくらいの頻度で再取得すべきか？
   - → **v1.1 の対応**: 24時間キャッシュ
   - → **v1.2 の対応**: ユーザー設定で調整可能に

4. **プライバシーポリシーの更新**
   - 外部ツールのデータを Claude API に送信することを、プライバシーポリシーに明記すべきか？
   - → **v1.1 リリース前に必須**: 法務レビュー + ポリシー更新

### 状況変化で再検討が必要な事項

- **MCP の普及**: Model Context Protocol が標準化された場合、Direct API 実装を MCP に置き換える
- **API コストの変化**: Anthropic API の料金体系が変わった場合、AI 推論の使用頻度を調整
- **競合の動向**: 類似プロダクトが自律的情報収集を実装した場合、差別化ポイントを再検討

## 関連ドキュメント

- [001-ambiguity-user-load-tradeoff.md](./001-ambiguity-user-load-tradeoff.md) - UI/UX でのユーザー負荷軽減策
- [Architecture](../02_product/architecture.md) - システムアーキテクチャ
- [Features](../02_product/features/FEATURES.md) - 機能一覧

---

**作成日**: 2025-02-22
**オーナー**: AI（Human 承認待ち）
**ステータス**: 論点整理完了 - Human 承認後に v1.1 実装開始
